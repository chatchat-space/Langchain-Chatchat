---
author: 技术平台部
---
# 登录

## DCUC

### 依赖POM

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-dcuc</artifactId>
</dependency>
```

### 参数配置

/config/duceap-security.properties参数配置说明：

```
#配置登陆方式，dids、dssoac、dcuc
duceap.security.type=dcuc

#单点登录服务器地址
duceap.security.dcuc.casServerUrlPrefix=http://192.168.10.12:8877/dcucserver
#业务系统后端地址（ip+port即可), 前后端分离使用nginx代理, ip需要配置成代理的地址(请全程使用真实的ip 而不是localhost或者127.0.0.1，否则会导致登录失败【前端ui-jz-v4-common组件升级至1.2.248后开发环境此配置将不生效，会根据前端请求动态生成此地址】)
duceap.security.dcuc.serverName=http://192.168.10.14:1655
#无须登录过滤的资源（如js，css等静态资源），多个用“|”隔开
duceap.security.dcuc.ignorePattern=/js/*|/img/*|/css/*|/dcuclogin/*|/authorizationPage.html|/importAuthorizationFile.html|/license/LicenseManagerServlet|/authorizationFile/
#应用代码
duceap.security.dcuc.appCode=YHZX0000000000000001
#用户中心服务接口地址
duceap.security.dcuc.ApiUrl=http://192.168.10.12:8870/dcuc
```

注：springboot默认读取application.properties配置文件，启动类需要指定properties加载路径

```
@PropertySource(value = {"classpath:config/duceap-security.properties"})
```

### 权限表创建

dcuc不会自动建t_security_right权限表，如果需要使用到这张表，需要手动指定脚本执行路径 oracle数据库：duceap.flyway.locations=classpath:/sql/oracle/duceap/securityright mysql数据库： duceap.flyway.locations=classpath:/sql/mysql/duceap/securityright 具体详见flyway章节



## DIDS

### 依赖POM

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-dids</artifactId>
</dependency>
```

### 参数配置

/config/duceap-security.properties参数配置说明：

```
#配置登陆方式，dids、dssoac、dcuc
duceap.security.type=dids

#dids登录配置#
#应用代码
duceap.security.dids2.appCode=340000000000009
#duceap.security.dids2.useSSO=true
#单点登录服务器地址
duceap.security.dids2.SSOLoginUrl=http://192.168.120.142:9999/didsserver/login
#单点登录服务接口地址
duceap.security.dids2.SSOValidateUrl=http://192.168.120.142:9999/didsserver/serviceValidate
#业务系统后端地址（ip+port即可), 前后端分离使用nginx代理, ip需要配置成代理的地址(请全程使用真实的ip 而不是localhost或者127.0.0.1，否则会导致登录失败【前端ui-jz-v4-common组件升级至1.2.248后开发环境此配置将不生效，会根据前端请求动态生成此地址】)
duceap.security.dids2.SSOServiceUrl=http://192.168.10.14:1655/test/login
#duceap.security.dids2.accessType=1
#单点登录服务接口地址
duceap.security.dids2.webServiceUrl=http://192.168.120.142:9999/didsserver/webservices/

#duceap.security.dids2.jndi=JDBC/DIDS

#duceap.security.dids2.filterType=1

#若匹配该地址，则无须过滤
duceap.security.dids2.noFilterUrl=services,hessian,commons,install.action,.xml,/install,/widgets-src/,/authorizationPage.html,/importAuthorizationFile.html,/license/LicenseManagerServlet,/authorizationFile/
```

注：springboot默认读取application.properties配置文件，启动类需要指定properties加载路径

```
@PropertySource(value = {"classpath:config/duceap-security.properties"})
```

来加载该配置文件

**duceap-security-dids更新到最新版本后，SSOServiceUrl不再强制需要结尾的/login了，可以和dcuc一样，只需要到http://ip:port/即可，加上也不会出错，没有任何影响。**

### 权限表创建

dids不会自动建t_security_right权限表，如果需要使用到这张表，需要手动指定脚本执行路径 oracle数据库：duceap.flyway.locations=classpath:/sql/oracle/duceap/securityright mysql数据库： duceap.flyway.locations=classpath:/sql/mysql/duceap/securityright 具体详见flyway章节

## DSSOAC

### 依赖POM

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-dssoac</artifactId>
</dependency>
```

### 参数配置

/config/duceap-security.properties参数配置说明：

```
#配置登陆方式，dids、dssoac、dcuc
duceap.security.type=dssoac

#dssoac配置#
duceap.security.dssoac.appCode=DUCEAP
#登陆URL
duceap.security.dssoac.loginUrl=/dssoac-login.html

#若匹配该地址，则无须过滤（例如XXX.do??
duceap.security.dssoac.noFilterUrl=
#若匹配该地址，则无须过滤（例如XXX.do??
duceap.security.dssoac.noDefaultFilterUrl=*/webservice/*,*.css,*.js,*.jpg,*.woff,*.gif,*.html,*.json,*.png,*/login/*,*commons/*,*/servlet/licensesrequest,*.xml,*/install*,*/widgets-src/*,*/demo4develop/*,authorizationPage.html,importAuthorizationFile.html,*/LicenseManagerServlet,*/authorizationFile/*,*/login,*/loginpage
```

## JWT

### 依赖POM

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-jwt</artifactId>
</dependency>
```

### 参数配置

- 服务间调用通过JWT传递用户信息

 默认情况下引入此包即开启JWT令牌过滤器，不需要额外配置。即服务请求方发起调用将当前上下文中的用户信息转换成JWT令牌并通过Header传递至服务提供方，服务提供方通过请求拦截器将获取到的令牌信息反序列化成BaseSecurityUser对象，并放置用户信息上下文中。

- 以下为jwt组件的参数配置，默认不需要配置，应用可根据实际项目选取对应的参数进行配置

```
 # 是否开启jwt安全认证，设置为true，如果请求中未解析出jwt token，将返回403
 #duceap.security.jwt.enabled=false

 # jwt认证需要拦截的请求地址，默认：拦截所有请求(/*)
 #duceap.security.jwt.url-patterns=/*
 # 忽略不进行jwt验证的地址正则规则，默认校验所有
 #duceap.security.jwt.ignore-url-pattern=

 # jwt token有效期时间(单位：毫秒)
 #duceap.security.jwt.validity-milliseconds=1800000

 # HS256加密算法所使用的秘钥
 #duceap.security.jwt.secret-key=SecretKey012345678901234567890123456789012345678901234567890123456789

 # RS256加密算法所使用的公钥
 #duceap.security.jwt.public-key=
 # RS256加密算法所使用的私钥
 #duceap.security.jwt.private-key=

 # 根据jwt token缓存用户信息到本地时长(单位：秒)
 #duceap.security.jwt.user-cache.expire-after-write=1800
 # 根据jwt token用户信息缓存器初始化大小
 #duceap.security.jwt.user-cache.initial-capacity=100
 # 根据jwt token用户信息缓存器最多缓存多少个用户信息
 #duceap.security.jwt.user-cache.maximum-size=1000
```

### 权限获取

#### 结合dcuc认证包获取权限信息

此场景适用于服务间相互调用或通过网关调用，且接入dcuc进行认证的应用

应用只需引入dcuc客户端包，并配置应用代码和dcuc用户中心接口服务地址即可

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-dcuc</artifactId>
</dependency>
```

```
#应用代码
duceap.security.dcuc.appCode=YHZX0000000000000001
#用户中心服务接口地址
duceap.security.dcuc.ApiUrl=http://192.168.10.12:8870/dcuc
```

请勿配置参数“duceap.security.type=dcuc”，否则会开启dcuc登录过滤，导致jwt认证流程失效

#### 结合dids认证包获取权限信息

此场景适用于服务间相互调用或通过网关调用，且接入dids进行认证的应用

应用只需引入dids客户端包，并配置应用代码和dids的webservice地址即可

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-dids</artifactId>
</dependency>
```

```
#应用代码
duceap.security.dids2.appCode=340000000000009
#单点登录服务接口地址
duceap.security.dids2.webServiceUrl=http://192.168.120.142:9999/didsserver/webservices/
```
## Oauth2

### 依赖POM

```
<dependency>
    <groupId>com.dragonsoft</groupId>
    <artifactId>duceap-security-oauth2</artifactId>
</dependency>
```

### 参数配置

/config/duceap-security.properties参数配置说明： 另外采用Oauth2认证方式需要部署Oauth2服务

```
#是否开启oauth2登录
duceap.security.oauth2.enabled=true

#配置oauth2认证服务地址（采用oauth2认证需要依赖oauth2认证服务）
#微服务环境下可不配置，客户端会通过oauth2服务进行调用，调用地址：http://gateway-oauth-server/gateway-oauth
#duceap.security.oauth2.oauthUrl=http://20.20.30.15:8103/gateway-oauth
```

### Token令牌传递规范

**Token令牌Key名称**

在Oauth2认证过程中，获取到的token令牌支持Header、传参两种方式传递，参数名为：access_token。

**Token令牌解析**

Oauth2认证依赖于JWT认证包，具备jwt包所具有的功能。

### 权限获取

用户权限通过调用oauth2认证服务接口获取，如果需要正确获取到用户权限信息，前端通过网关认证时需要传入正确的appCode，否则无法获取到用户权限信息