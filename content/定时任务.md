---
author: 技术平台部
---
# 定时任务

## Spring Schedule使用

### 1.启动类，添加@EnableScheduling注解即可启动schedule

```java
@EnableScheduling
@SpringBootApplication
public class ScheduleApplication {
    public static void main(String[] args) {
        SpringApplication.run(ScheduleApplication.class, args);
    }
}
```

### 2.添加定时任务

- 采用Cron表达式

```java
@Component
public class MyTask {
    @Scheduled(cron = "0/10 * * * * *")
    public void work() {
        // task execution logic
    }
}
```

- 固定间隔任务


```java
    @Scheduled(fixedDelay = 1000*10)
    public void work() {
        // task execution logic
    }
```

- 固定频率任务

```java
    @Scheduled(fixedRate = 1000*10)
    public void work() {
        // task execution logic
    }
```

## Elastic-Job分布式调度

### 1.POM依赖

```
    <dependency>
        <groupId>com.dragonsoft</groupId>
        <artifactId>duceap-boot-starter-job</artifactId>
    </dependency>
```

### 2.配置说明


- Zookeeper注册中心参数配置

```

    #是否开启elasticJob计划，默认为true
    duceap.elastic.job.enabled=true
    #连接Zookeeper服务器的列表包括IP地址和端口号多个地址用逗号分隔如: host1:2181,host2:2181
    duceap.elastic.job.zk.serverLists=localhost:2181
    #Zookeeper的命名空间，不配置情况下采用appCode
    duceap.elastic.job.zk.namespace=job_test1
	# 连接Zookeeper的权限令牌，缺省为不需要权限验证
    #duceap.elastic.job.zk.digest=root
```

- SimpeJob参数配置


```
    #cron表达式，用于控制作业触发时间
    duceap.elastic.job.MySimpleJob.cron=0/20 * * * * ?
    #本地配置是否可覆盖注册中心配置 如果可覆盖，每次启动作业都以本地配置为准
    duceap.elastic.job.MySimpleJob.overwrite=true
    #作业分片总数
    duceap.elastic.job.MySimpleJob.shardingTotalCount=3
    #分片序列号和参数用等号分隔，多个键值对用逗号分隔 分片序列号从0开始，不可大于或等于作业分片总数
    #如：0=a,1=b,2=c
    duceap.elastic.job.MySimpleJob.shardingItemParameters=0=A,1=B,2=C
    #作业自定义参数
    duceap.elastic.job.MySimpleJob.jobParameter=test
    #是否开启任务执行失效转移,默认false
    duceap.elastic.job.MySimpleJob.failover=true
    #是否开启错过任务重新执行，默认true
    duceap.elastic.job.MySimpleJob.misfire=true
    duceap.elastic.job.MySimpleJob.description=simple job
    #监控作业运行时状态,默认false
    duceap.elastic.job.MySimpleJob.monitorExecution=false
    #前置后置任务监听实现类
    duceap.elastic.job.MySimpleJob.listener=com.dragonsoft.duceap.elasticjob.handler.MessageElasticJobListener
    #扩展异常处理类
    duceap.elastic.job.MySimpleJob.jobExceptionHandler=com.dragonsoft.duceap.elasticjob.handler.CustomJobExceptionHandler
    #是否启用JOB
    duceap.elastic.job.MySimpleJob.disabled=false
    #作业事件追踪的数据源Bean引用
    duceap.elastic.job.MySimpleJob.eventTraceRdbDataSource=dataSource
    #是否启用Mq作业事件追踪,默认false，当eventTraceRdbDataSource有配置则此优先
    #duceap.elastic.job.MySimpleJob.eventTraceMQEnabled=true
    #当启用Mq作业事件追踪采用的消息主题，默认90000001主题
    #duceap.elastic.job.MySimpleJob.eventTraceMQTopic=90000001
```


- 其他Job配置实例

```
    #DataflowJob配置示例
    #duceap.elastic.job.MyDataflowJob.cron=0/10 * * * * ?
    #duceap.elastic.job.MyDataflowJob.overwrite=true
    ##duceap.elastic.job.MyDataflowJob.eventTraceRdbDataSource=datasource
    #duceap.elastic.job.MyDataflowJob.disabled=true

    #ScriptJob配置示例
    #duceap.elastic.job.MyScriptJob.cron=0/10 * * * * ?
    #duceap.elastic.job.MyScriptJob.overwrite=true
    #脚本型作业执行命令行
    #duceap.elastic.job.MyScriptJob.scriptCommandLine=D:\\apache-tomcat-addrepo-allcity\\bin\\startup.bat
```

### 3.JOB开发

- 配置MySimpleJob任务

```java
@ElasticJobConf(name = "MySimpleJob")
public class MySimpleJob implements SimpleJob {

	public void execute(ShardingContext context) {
		String shardParamter = context.getShardingParameter();
		System.out.println("分片参数："+shardParamter);

		switch (context.getShardingItem()) {
			case 0:
				System.out.println(":开始执行简单任务分片0，参数：" + shardParamter );
				// do something by sharding item 0
				break;
			case 1:
				// do something by sharding item 1
				System.out.println(":开始执行简单任务分片1，参数：" + shardParamter );
				break;
			case 2:
				System.out.println(":开始执行简单任务分片2，参数：" + shardParamter );
				// do something by sharding item 2
				break;
			// case n: ...
		}
	}
}
```

- 直接通过@ElasticJobConf注解配置Job，如下：

```java
@ElasticJobConf(name = "MySimpleJob2",cron = "0/2 * * * * ?")
public class MySimpleJob2 implements SimpleJob {

	public void execute(ShardingContext context) {
		String shardParamter = context.getShardingParameter();
		System.out.println("MySimpleJob2分片参数："+shardParamter);
	}
}
```